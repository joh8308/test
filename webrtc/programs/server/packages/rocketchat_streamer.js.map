{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:streamer/lib/ev.js","meteor://ðŸ’»app/packages/rocketchat:streamer/server/server.js"],"names":["EV","handlers","emit","event","args","forEach","handler","apply","emitWithScope","scope","on","callback","push","once","self","onetimeCallback","arguments","removeListener","index","indexOf","splice","removeAllListeners","undefined","StreamerCentral","instances","Meteor","Streamer","name","retransmit","retransmitToSelf","console","warn","subscriptions","subscriptionsByEventName","transformers","iniPublication","initMethod","_allowRead","_allowEmit","_allowWrite","allowRead","allowEmit","allowWrite","eventName","fn","error","Boolean","userId","isReadAllowed","call","isEmitAllowed","isWriteAllowed","addSubscription","subscription","removeSubscription","transform","applyTransformers","methodScope","tranformed","Array","isArray","stream","publish","subscriptionName","useCollection","check","String","Match","Optional","length","stop","onStop","_session","sendAdded","ready","method","unblock","connection","originalParams","_emit","methods","e","origin","broadcast","sendChanged","emitWithoutBroadcast","_name","_retransmit","_retransmitToSelf"],"mappings":"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","file":"/packages/rocketchat_streamer.js","sourcesContent":["/* globals EV:true */\n/* exported EV */\n\nEV = class EV {\n\tconstructor() {\n\t\tthis.handlers = {};\n\t}\n\n\temit(event, ...args) {\n\t\tif (this.handlers[event]) {\n\t\t\tthis.handlers[event].forEach((handler) => handler.apply(this, args));\n\t\t}\n\t}\n\n\temitWithScope(event, scope, ...args) {\n\t\tif (this.handlers[event]) {\n\t\t\tthis.handlers[event].forEach((handler) => handler.apply(scope, args));\n\t\t}\n\t}\n\n\ton(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\tthis.handlers[event] = [];\n\t\t}\n\t\tthis.handlers[event].push(callback);\n\t}\n\n\tonce(event, callback) {\n\t\tself = this;\n\t\tself.on(event, function onetimeCallback() {\n\t\t\tcallback.apply(this, arguments);\n\t\t\tself.removeListener(event, onetimeCallback);\n\t\t});\n\t}\n\n\tremoveListener(event, callback) {\n\t\tif(this.handlers[event]) {\n\t\t\tconst index = this.handlers[event].indexOf(callback);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.handlers[event].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveAllListeners(event) {\n\t\tthis.handlers[event] = undefined;\n\t}\n};\n","/* globals EV */\n/* eslint new-cap: false */\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, {retransmit = true, retransmitToSelf = false} = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\n\t\tsuper();\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.retransmit = retransmit;\n\t\tthis.retransmitToSelf = retransmitToSelf;\n\n\t\tthis.subscriptions = [];\n\t\tthis.subscriptionsByEventName = {};\n\t\tthis.transformers = {};\n\n\t\tthis.iniPublication();\n\t\tthis.initMethod();\n\n\t\tthis._allowRead = {};\n\t\tthis._allowEmit = {};\n\t\tthis._allowWrite = {};\n\n\t\tthis.allowRead('none');\n\t\tthis.allowEmit('all');\n\t\tthis.allowWrite('none');\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget retransmit() {\n\t\treturn this._retransmit;\n\t}\n\n\tset retransmit(retransmit) {\n\t\tcheck(retransmit, Boolean);\n\t\tthis._retransmit = retransmit;\n\t}\n\n\tget retransmitToSelf() {\n\t\treturn this._retransmitToSelf;\n\t}\n\n\tset retransmitToSelf(retransmitToSelf) {\n\t\tcheck(retransmitToSelf, Boolean);\n\t\tthis._retransmitToSelf = retransmitToSelf;\n\t}\n\n\tallowRead(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowRead[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowEmit(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowEmit[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowWrite(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowWrite[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowWrite shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tisReadAllowed(scope, eventName) {\n\t\tif (this._allowRead[eventName]) {\n\t\t\treturn this._allowRead[eventName].call(scope, eventName);\n\t\t}\n\n\t\treturn this._allowRead['__all__'].call(scope, eventName);\n\t}\n\n\tisEmitAllowed(scope, eventName, ...args) {\n\t\tif (this._allowEmit[eventName]) {\n\t\t\treturn this._allowEmit[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowEmit['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisWriteAllowed(scope, eventName, args) {\n\t\tif (this._allowWrite[eventName]) {\n\t\t\treturn this._allowWrite[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowWrite['__all__'].call(scope, eventName, ...args);\n\t}\n\n\taddSubscription(subscription, eventName) {\n\t\tthis.subscriptions.push(subscription);\n\n\t\tif (!this.subscriptionsByEventName[eventName]) {\n\t\t\tthis.subscriptionsByEventName[eventName] = [];\n\t\t}\n\n\t\tthis.subscriptionsByEventName[eventName].push(subscription);\n\t}\n\n\tremoveSubscription(subscription, eventName) {\n\t\tconst index = this.subscriptions.indexOf(subscription);\n\t\tif (index > -1) {\n\t\t\tthis.subscriptions.splice(index, 1);\n\t\t}\n\n\t\tif (this.subscriptionsByEventName[eventName]) {\n\t\t\tconst index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.subscriptionsByEventName[eventName].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\ttransform(eventName, fn) {\n\t\tif (typeof eventName === 'function') {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (!this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName] = [];\n\t\t}\n\n\t\tthis.transformers[eventName].push(fn);\n\t}\n\n\tapplyTransformers(methodScope, eventName, args) {\n\t\tif (this.transformers['__all__']) {\n\t\t\tthis.transformers['__all__'].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, eventName, args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, ...args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn args;\n\t}\n\n\tiniPublication() {\n\t\tconst stream = this;\n\t\tMeteor.publish(this.subscriptionName, function(eventName, useCollection) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(useCollection, Match.Optional(Boolean));\n\n\t\t\tif (eventName.length === 0) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (stream.isReadAllowed(this, eventName) !== true) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst subscription = {\n\t\t\t\tsubscription: this,\n\t\t\t\teventName: eventName\n\t\t\t};\n\n\t\t\tstream.addSubscription(subscription, eventName);\n\n\t\t\tthis.onStop(() => {\n\t\t\t\tstream.removeSubscription(subscription, eventName);\n\t\t\t});\n\n\t\t\tif (useCollection === true) {\n\t\t\t\t// Collection compatibility\n\t\t\t\tthis._session.sendAdded(stream.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.ready();\n\t\t});\n\t}\n\n\tinitMethod() {\n\t\tconst stream = this;\n\t\tconst method = {};\n\n\t\tmethod[this.subscriptionName] = function(eventName, ...args) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(args, Array);\n\n\t\t\tthis.unblock();\n\n\t\t\tif (stream.isWriteAllowed(this, eventName, args) !== true) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst methodScope = {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnection: this.connection,\n\t\t\t\toriginalParams: args,\n\t\t\t\ttranformed: false\n\t\t\t};\n\n\t\t\targs = stream.applyTransformers(methodScope, eventName, args);\n\n\t\t\tstream.emitWithScope(eventName, methodScope, ...args);\n\n\t\t\tif (stream.retransmit === true) {\n\t\t\t\tstream._emit(eventName, args, this.connection, true);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\tMeteor.methods(method);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\t_emit(eventName, args, origin, broadcast) {\n\t\tif (broadcast === true) {\n\t\t\tMeteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n\t\t}\n\n\t\tconst subscriptions = this.subscriptionsByEventName[eventName];\n\t\tif (!Array.isArray(subscriptions)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n\t\t\t\tsubscription.subscription._session.sendChanged(this.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\targs: args\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\temit(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, true);\n\t}\n\n\temitWithoutBroadcast(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, false);\n\t}\n};\n"]}